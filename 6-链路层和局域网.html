<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>第六章 链路层和局域网</title>
	</head>
	<body>
		链路层提供的服务:成帧、链路接入、可靠交付、差错检测和纠正。<br />
		链路层的主体部分是在网络适配器中实现，网络适配器有时也称为网络接收卡。位于网络适配器核心的是链路层控制器，该控制器通常是一个实现了许多链路层服务（成帧、链路接入、差错检测等）的专用芯片。<br />
		在发送端，控制器取得了由协议栈较高层次生成并存储在主机内存中的数据报，在链路层帧中封装该数据报（填写该帧的各个字段），然后遵循链路接入协议，然后将该帧传进通讯链路中。在接收端，控制器接受了整个帧，
		抽取出网络层数据报。如果链路层执行差错检测，则需要发送控制器在该帧的首部设置差错检测比特，由接受控制器执行差错检测。
		链路层是硬件和软件的结合体。此处是协议栈中软件和硬件交接的地方。
		<h2>差错检测和纠正技术</h2>
		<div>
			<h3>奇偶校验</h3>
			<div>
				
			</div>
			<h3>检验和方法</h3>
			<div>
				
			</div>
			<h3>循环冗余检测</h3>
			<div>
				
			</div>
		</div>
		<h2>多路访问链路和协议</h2>
		<div>
			点对点链路：由链路一端的单个发送方和链路另一端的单个接收方组成。点对点链路协议：点对点协议（PPP）、高级数据链路控制（HDLC）<br />
			广播链路：他能够让多个发送方和多个接收方都连接到相同的、单一的、共享的广播信道上。当任何一个节点传输一个帧时，信道广播该帧，每个节点都收到一个副本。如何协调多个发送和接受节点
			对一个共享的广播信道的访问，就是多路访问问题。<br />
			多路访问协议：节点通过协议来规范他们在共享的广播信道上的传输行为。<br />
			碰撞：对于广播链路，因为所有节点都能传输帧，所以多个节点可能会同时传输帧。当发生这种情况时，所有节点同时接受到多个帧；也就是说传输帧在所有接收方处碰撞。通常当发生碰撞时，没有一个节点能有效地获得任何传输的帧；碰撞的信号纠缠
			在一起。因此，涉及此次碰撞的所有帧都丢失了，碰撞时间间隔中的广播信道被浪费了。<br />
			<h3>信道划分协议</h3>
			<div>
				<h4>十分多路复用（TDM）</h4>
				<div>
					一个支持N个节点的信道，且信道的传输速率为Rbps，TDM将时间划分成时间帧并进一步划分每个时间帧为N个时隙。然后把每个时隙分配给N个节点中的一个。无论何时，某个节点在有分组要发送的时候，他在循环的TDM帧中指派给它的时隙内传输分组
					比特。通常选择的时隙长度应该使一个时隙内能够传输单个分组。<br />
					优点：消除了碰撞且非常公平，每个节点在每个帧时间内得到专用的传输速率R/Nbps。<br />
					缺点：节点被限制于R/Nbps的平均速率，即使当前它是唯一有分组要发送的节点。节点必须总是等待它的传输序列中的轮次。
				</div>
				<h4>频分多路复用（FDM）</h4>
				<div>
					FDM将Rbps信道划分为不同的频段，每个频段具有（R/Nbps）带宽，并把每个频率分配给N个节点中的一个，因此FDM在单个较大的Rbps信道中创建了N个较小的R/Nbps信道。<br />
					优点：避免了碰撞，公平地划分了带宽<br />
					缺点：限制一个节点只能使用R/Nbps的带宽，即使它是唯一一个需要发送数据的节点。
				</div>
				<h4>码分多路复用（CDMA）</h4>
				<div>
					CMDA对每个节点分配一种不同的编码。然后每个节点用它唯一的编码来对他发送的数据进行编码。如果精心选择这些编码，不同的节点能够同时传输，并且他们各自相应接收方仍能正常接收发送
					方编码的数据比特，而不在乎其他节点的干扰传输。
				</div>
			</div>
			<h3>随机接入协议</h3>
			<div>
				随机接入协议中，一个节点总是以信道的全部速率进行发送。当有碰撞时，涉及碰撞的每个节点反复重发它的帧，到该帧无碰撞地通过为止。但是当一个节点经历一次碰撞时，它不必立刻重发该帧。相反
				他在重发该帧之前等待一个随机时延。设计碰撞的每个节点独立地选择随机时延。因为该随机时延是独立地选择的，所以以下现象是可能的：这些节点之一所选择的时延充分小于其他碰撞节点的时延，并因此能够无碰撞地将它的帧在信道中发出。
				<h4>时隙ALOHA</h4>
				<div>
					    
				</div>
			</div>
			<h3>轮流协议</h3>
			<div>
				多路访问协议的两个理想特性：1、当只有一个节点活跃时，该活跃节点有Rpbs的吞吐量；2、当有M个活跃节点的吞吐量接近R/Mbps；<br />
				轮流协议就是为了达到这两个理想特性而设计的：<br />
				下面是两种轮询协议：<br />
				第一种轮流协议：轮流协议要求这些节点之一要被指定为主节点。主节点以循环方式轮询每个节点。特别是，主节点首先向节点1发送一个报文，告诉他能够传输的帧的最多数量（主节点能够通过观察在信道上
				是否缺乏信号，来决定一个节点何时完成了帧的传输）上诉过程以这样的方式继续进行，主节点以循环的方式轮询了每个节点。<br>
				缺点：1、该协议引入了轮询时延，即通知一个节点“它可以传输”所需要的时间；2、如果主节点有故障，整个信道都变得不可操作；<br />
				第二种轮询协议：令牌传输协议，这种协议没有主节点，一个称为令牌的小的特殊帧在节点之间以某种固定的次序进行交换。例如：节点1可能总是将令牌传输给节点2，节点2总是把令牌传输给节点3，而节点N总是把令牌传输给节点1.当一个
				节点收到令牌时，仅当它由一些帧要发送时，它才持有这个令牌；否则，它立即向下一个节点转发该令牌。当一个节点收到令牌时，如果它确实有帧要传输，它发送最大数目的帧数，然后把令牌转发给下一个节点。
				令牌传递时分散的，且很高效；<br />
				缺点：一个节点故障可能使整个信道崩溃，或一个节点偶然忘记释放令牌，则必须调用某些恢复步骤使令牌返回到循环中来。
			</div>
			
		</div>
		<h2>交换局域网</h2>
		<div>
			<h3>链路层寻址和ARP</h3>
			<div>
				<div>
					MAC地址：也称LAN地址、物理地址，对大多数局域网，MAC地址长度为6字节，共计2的48次方个可能的地址，通常用十六进制表示法，IEEE管理者MAC地址的分配。
					当适配器收到一个帧时，将检查该帧中的目的MAC地址是否与自己的MAC地址匹配，如果匹配，该适配器提取出分装的数据报，并将该数据报沿协议栈向上传递。如果不
					匹配，该适配器丢弃该帧，不向上传递该数据报。<br />
					有时发送适配器的确要让局域网上所有的其他适配器来收到并处理它打算发送的帧。发送适配器在该帧的目的地址字段中插入一个特殊的MAC广播地址。对于使用6字节的局域网，广播地址是48个
					连续的1组成的字符串（十六进制：FF-FF-FF-FF-FF-FF）
				</div>
				<div>
					ARP地址解析协议：网络层地址和链路层地址之间转换；ARP只为在同一个子网上的主机和路由器接口解析IP地址。<br>
					每一个主机都设有一个 ARP 高速缓存(ARP cache)，里面有所在的局域网上的各主机和路由器的 IP 地址到硬件地址的映射表。<br />
					当主机 A 欲向本局域网上的某个主机 B 发送 IP 数据报时，就先在其 ARP 高速缓存中查看有无主机 B 的 IP 地址。如有，就可查出其对应的硬件地址，再将此硬件地址写入 MAC 帧，然后通过局域网将该 MAC 帧发往此硬件地址。  <br />
					<img src="./res/6-1.png" /><br />
					为了减少网络上的通信量，主机 A 在发送其 ARP 请求分组时，就将自己的 IP 地址到硬件地址的映射写入 ARP 请求分组。<br />
					当主机 B 收到 A 的 ARP 请求分组时，就将主机 A 的这一地址映射写入主机 B 自己的 ARP 高速缓存中。这对主机 B 以后向 A 发送数据报时就更方便了。<br />
					ARP 是解决同一个局域网上的主机或路由器的 IP 地址和硬件地址的映射问题。<br />
					如果所要找的主机和源主机不在同一个局域网上，那么就要通过 ARP 找到一个位于本局域网上的某个路由器的硬件地址，然后把分组发送给这个路由器，让这个路由器把分组转发给下一个网络。剩下的工作就由下一个网络来做。<br />
					从IP地址到硬件地址的解析是自动进行的，主机的用户对这种地址解析过程是不知道的。<br />
					只要主机或路由器要和本网络上的另一个已知 IP 地址的主机或路由器进行通信，ARP 协议就会自动地将该 IP 地址解析为链路层所需要的硬件地址。  <br />
					<h4>使用 ARP 的四种典型情况 </h4>
					<div>
						发送方是主机，要把IP数据报发送到本网络上的另一个主机。这时用 ARP 找到目的主机的硬件地址。 <br />
						发送方是主机，要把 IP 数据报发送到另一个网络上的一个主机。这时用 ARP 找到本网络上的一个路由器的硬件地址。剩下的工作由这个路由器来完成。 <br />
						发送方是路由器，要把 IP 数据报转发到本网络上的一个主机。这时用 ARP 找到目的主机的硬件地址。 <br />
						发送方是路由器，要把 IP 数据报转发到另一个网络上的一个主机。这时用 ARP 找到本网络上另一个路由器的硬件地址。剩下的工作由这个路由器来完成。 <br />
					</div>
				</div>
				<div>
					<h4>发送数据报到子网以外</h4>
					<div>
						ARP 是解决同一个局域网上的主机或路由器的 IP 地址和硬件地址的映射问题。如果所要找的主机和源主机不在同一个局域网上，那么就要通过 ARP 找到一个位于
						本局域网上的某个路由器的硬件地址，然后把分组发送给这个路由器，让这个路由器把分组转发给下一个网络。剩下的工作就由下一个网络来做。
					</div>
				</div>
			</div>
			<h3>
				以太网
			</h3>
			<div>
				<h4>使用集线器的双绞线以太网 </h4>
				<div>
					<img src="./res/6-2.png" /><br />
					采用星形拓扑，在星形的中心则增加了一种可靠性非常高的设备，叫做集线器(hub)  <br />
					集线器是使用电子器件来模拟实际电缆线的工作，因此整个系统仍然像一个传统的以太网那样运行。 使用集线器的以太网在逻辑上
					仍是一个总线网，各工作站使用的还是 CSMA/CD 协议，并共享逻辑上的总线。 集线器很像一个多接口的转发器，工作在物理层。<br />
					它作用于比特，当表示一个0或者一个1的比特到达接口是，集线器总是重新生成这个比特，将其能量强度放大，并将该比特向其他所有接口传输出去，
					无论何时集线器从它的一个接口收到一个比特，它向所有其他接口发送该比特的副本，如果集线器同时从两个接口接收到帧，将出现一次碰撞，生成该帧的节点必须重新传输该帧。<br />
					具有三个接口的集线器 :<br />
					<img src="./res/6-3.png" /><br /><br />
					优点<br />
					使原来属于不同碰撞域的局域网上的计算机能够进行跨碰撞域的通信。<br />
					扩大了局域网覆盖的地理范围。<br /><br />
					缺点<br />
					碰撞域增大了，但总的吞吐量并未提高。<br />
					如果不同的碰撞域使用不同的数据率，那么就不能用集线器将它们互连起来。  <br /> 
					用集线器组成更大的局域网都在一个碰撞域中<br />
					<img  src="./res/6-6.png"/>
				</div>
				<h4>以太网帧结构</h4>
				<div>
					常用的以太网MAC帧格式有两种标准 ：<br />
					DIX Ethernet V2 标准<br />
					IEEE 的 802.3 标准<br />
					最常用的 MAC 帧是以太网 V2 的格式<br /><br />
					以太网的 MAC 帧格式 <br />
					<img src="./res/6-4.png" />
					<br />
					以太网 V2 的 MAC 帧格式 <br />
					<img src="./res/6-5.png" />
					<br />
					类型字段用来标志上一层使用的是什么协议，以便把收到的 MAC 帧的数据上交给上一层的这个协议。 <br />
					数据字段的正式名称是 MAC 客户数据字段,最小长度 64 字节  18 字节的首部和尾部 = 数据字段的最小长度  <br />
					当数据字段的长度小于 46 字节时，应在数据字段的后面加入整数字节的填充字段，以保证以太网的 MAC 帧长不小于 64 字节。 <br />
					为了达到比特同步，在传输媒体上实际传送的要比 MAC 帧还多 8 个字节<br />
					在帧的前面插入的 8 字节中的第一个字段共 7 个字节，是前同步码，用来迅速实现 MAC 帧的比特同步。第二个字段是帧开始定界符，表示后面的信息就是MAC 帧。<br />
				</div>
				<div>
					以太网技术
				</div>
			</div>
			<h3>链路层交换机</h3>
			<div>
				交换机的任务是接收链路层帧并将它们转发出链路；交换机自身对子网中的主机和路由器时透明的；也就是说主机/路由器向另一个主机/路由器寻址一个帧，顺利地将该帧发送进局域网，
				并不知道某交换机将会接收该帧并将它转发到另一个节点，这些帧到达该交换机任何输出接口之一的速率可能暂时超过该接口链路的容量，为了解决这个问题，交换机输出接口设有缓存。
				<h4>交换机转发和过滤</h4>
				<div>
					在数据链路层扩展局域网是使用交换机。交换机工作在数据链路层，它根据 MAC 帧的目的地址对收到的帧进行转发。交换机具有过滤帧的功能。当交
					换机收到一个帧时，并不是向所有的接口转发此帧，而是先检查此帧的目的 MAC 地址，然后再确定将该帧转发到哪一个接口 。<br />
					交换机的过滤和转发是借助于交换机表完成。该交换机表包含某局域网还是那个某些主机和路由器但不必是全部的表项。交换机表中的一个表项包含：<br />
					1、一个mac地址；<br />
					2、通向该Mac地址的交换机接口；<br />
					3、表项放置在表中的时间；<br />
					在交换机的转发表中写入的信息除了地址和接口外，还有帧进入该交换机的时间。这是因为以太网的拓扑可能经常会发生变化，站点也可能会更换适配器
					（这就改变了站点的地址）。另外，以太网上的工作站并非总是接通电源的。把每个帧到达交换机的时间登记下来，就可以在转发表中只保留网络拓扑的最新状态信息。这样就使得交换机中的转发表能反映当前网络的最新拓扑状态。 <br />
					交换机收到一个帧会有3种可能的情况：目的地址为DD-DD-DD-DD-DD-DD的帧从交换机接口x到达。交换机使用DD-DD-DD-DD-DD-DD索引它的表<br />
					1、没有对于目的地址的表项，交换机向除了接口x外的所有接口前面输出缓存转发该帧的副本，即广播该帧。<br />
					2、表项将DD-DD-DD-DD-DD-DD与接口x关联，该帧在说在的局域网已经广播过了，交换机丢弃该帧执行过滤功能。<br />
					3、表项将DD-DD-DD-DD-DD-DD与接口y(y!=x)关联，该帧需要转发到与接口y相连的局域网段。交换机将该帧放到接口y前面的输出缓存完成转发功能。<br />
				</div>
				<h4>自学习</h4>
				<div>
					交换机是一种即插即用设备，它的表是自动、动态和自治地建立的：交换机收到一帧后先进行自学习。查找转发表中与收到帧的源地址有无相匹配的项目。如没有，就在转发表中增加一个项目
					（源地址、进入的接口和时间）。如有，则把原有的项目进行更新<br />
					1、交换机表初始为空；<br />
					2、对于每个接口收到的每个入帧，该交换机在其表中存储：（1）在该帧源地址字段中的mac地址；（2）该帧到达的接口；（3）当前时间。交换机以这种方式在它的表项中记录了发送节点
					所在的局域网网段。如果在局域网上的每个主机最终都发送了一个帧，则每个主机最终将在这张表中留有记录；<br />
					3、如果一段时间（称为老化期）后，交换机没有接收到该地址作为源地址的帧，就在表中删除这个地址。以这种方式，如果一台PC被另一个PC替代，原来PC的mac地址最终将从该交换机表中被清除.<br />
					<br />
					特性：<br />
					以太网交换机的每个接口都直接与主机相连，并且一般都工作在全双工方式。<br />
					交换机能同时连通许多对的接口，使每一对相互通信的主机都能像独占通信媒体那样，进行无碰撞地传输数据。 <br />
					以太网交换机由于使用了专用的交换结构芯片，其交换速率就较高。    <br />
					<br />
					优点：<br />
					过滤通信量。 <br />
					扩大了物理范围。<br />
					提高了可靠性。<br />
					可互连不同物理层、不同 MAC 子层和不同速率（如10 Mb/s 和 100 Mb/s 以太网）的局域网<br />
					缺点：<br />
					存储转发增加了时延。 <br />
					在MAC 子层并没有流量控制功能。 <br />
					具有不同 MAC 子层的网段桥接在一起时时延更大。<br />
					网桥只适合于用户数不太多(不超过几百个)和通信量不太大的局域网，否则有时还会因传播过多的广播信息而产生网络拥塞。这就是所谓的广播风暴。 <br /> 
				</div>
				<h4>交换机和路由器比较</h4>
				
			</div>
			<h3>虚拟局域网</h3>
			<div>
				虚拟局域网 VLAN 是由一些局域网网段构成的与物理位置无关的逻辑组。<br />
				这些网段具有某些共同的需求。<br />
				每一个 VLAN 的帧都有一个明确的标识符，指明发送这个帧的工作站是属于哪一个 VLAN。<br />
				虚拟局域网其实只是局域网给用户提供的一种服务，而并不是一种新型局域网。 <br />
				<img src="./res/6-7.png" /><br />
				当 B1 向 VLAN2 工作组内成员发送数据时，工作站 B2 和 B3 将会收到广播的信息。
				B1 发送数据时，工作站 A1, A2 和 C1都不会收到 B1 发出的广播信息。 
				虚拟局域网限制了接收广播信息的工作站数，使得网络不会因传播过多的广播信息(即“广播风暴”)而引起性能恶化
				<br /><br />
				虚拟局域网使用的以太网帧格式：<br />
				虚拟局域网协议允许在以太网的帧格式中插入一个 4 字节的标识符，称为 VLAN 标记(tag)，用来指明发送该帧的工作站属于哪一个虚拟局域网。 <br />
				<img src="./res/6-8.png" />
			</div>
			
		</div>
		<h2>链路虚拟化：网络作为链路层</h2>
		<div>
			<h3>多协议标签交换</h3>
			<div>
				
			</div>
		</div>
		
		<h2>数据中心网络</h2>
		<div>
			每个数据中心都有数万至数十万太主机，这些主机同时支持者不同的云应用；每个数据中心都有自己的数据中心网络，这些数据中心网络将其内部主机彼此互联并与因特网中的数据中心互联。<br />
			主机就像数据中心的工蜂：他们负责提供内容，存储邮件和文档，并共同执行大规模分布式计算。数据中心的主机称为刀片，一般包括CPU、内存和磁盘存储的商用主机。主机被堆叠在机架上，每个机架
			一般堆放20~40台刀片。在每个机架顶部都有一台交换机，这台交换机被形象的称为机架顶部交换机（Top of Rack,TOR）,他们与机架上的主机互联，并与数据中心的其他交换机互联。具体来说，机架上的每台主机
			都有一块与TOR交换机连接的网卡，每台TOR交换机都有额外的端口能够与其他的TOR交换机连接。目前主机通常用40G的以太网连接到他们的TOR交换机。每台主机也会分配一个自己的数据中心内部的IP地址。<br />
			数据中心网络支持两种类型的流量：在外部客户与内部主机之间流动的流量，以及内部主机之间流动的流量。为了处理外部客户与内部主机之间流动的流量，数据中心包括了一台或者多台边界路由器，他们将数据中心网络
			与公共因特网相连。数据中心网络因此需要将所有机架彼此互联，并将机架与边界路由器连接。下图是一个具有等级拓扑的数据中心网络<br />
			<img src="./res/6-9.png" />
			
			<h3>负载均衡</h3>
			<div>
				为了支持外部的客户请求，每一个应用都与一个公开可见的IP地址关联，外部用户向该地址发送其请求并从该地址接收响应。在数据中心内部，外部请求首先被重定向到一个负载均衡器。负载均衡器的任务是向主机分发请求，以主机当前的负载均衡作为函数
				在主机之间均衡负载。一个大型的数据中心通常会有几台负载均衡器，每台服务于一组特定的云应用。由于负载均衡器基于分组的目的端口号以及目的IP地址做决策，因此他们通常被称为"第四层交换机"。一旦接收到一个对于特定应用程序的请求，负载均衡将
				该请求分发到处理该应用的某一台主机上（该主机可能再调用其他主机的服务来协助处理该请求）。当主机处理完该请求后，向负载均衡器回送响应，再由负载均衡器将其中继发给外部客户。负载均衡不仅平衡主机间的工作负载，而且还提供类似NAT的功能，
				将外部IP地址转换为内部适当主机的IP地址，然后将反方向流向客户的分组按照相反的转换进行处理。这防止客户直接接触主机，从而具有隐藏网络内部结构和防止客户直接与主机交互等安全益处。
				
			</div>
			<h3>数据中心网络发展趋势</h3>
			<div>
				部署能够克服传统等级设计缺陷的新型互联网体系结构和网络协议：<br />
				1、采用全连接拓扑来替代交换机和路由器的等级结构。
				2、采用基于船运集装箱的模块化数据中心。
			</div>
		</div>
		
		<h2>回顾：Web页面请求的历程</h2>
		<div>
			#todo
		</div>
		
		
		
	</body>
</html>
